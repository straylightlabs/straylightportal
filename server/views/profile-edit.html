{% extends 'layouts/dashboard.html' %}

{% block title %}
{% if user.isOnboarded %}
Edit profile
{% else %}
Step 1: Profile
{% endif %}
{% endblock %}

{% block content %}
{% if !user.isOnboarded %}
<div class="short-card mdl-card mdl-shadow--2dp">
  <div class="mdl-card__title">
    <h2 class="mdl-card__title-text">Step 1 of 3: Create your profile</h2>
  </div>
  <div class="mdl-card__supporting-text">
    Information provided here will be visible to other Straylight members. 
    Any information marked private will be visible only to admins.
  </div>
</div>
{% endif %}
<form id="profile-form" action="{{base_url}}/user/profile" method="post" enctype="multipart/form-data">
  <div class="mdl-grid">
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--12-col">
      <input class="mdl-textfield__input" type="text" value="{{user.profile.displayName}}" id="full-name" name="displayName" data-required>
      <label class="mdl-textfield__label" for="full-name">Full name</label>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--file mdl-cell mdl-cell--8-col">
      <input class="mdl-textfield__input" placeholder="Profile photo" type="text" id="upload-file" readonly/>
      <div class="mdl-button mdl-button--primary mdl-button--icon mdl-button--file">
	<i class="material-icons">attach_file</i><input type="file" name="avatar" id="upload-button">
      </div>
    </div>
    {% if user.profile.imageUrl %}
    <img src="{{user.profile.imageUrl}}" alt="profile image" class="avatar mdl-cell mdl-cell--4-col">
    {% endif %}
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--12-col">
      <input class="mdl-textfield__input" type="text" id="address_line1" name="addressStreet" value="{{user.profile.mailingAddress.street}}" data-required>
      <label class="mdl-textfield__label" for="address_line1">Mailing address</label>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--6-col">
      <input class="mdl-textfield__input" type="text" id="address_city" name="addressCity" value="{{user.profile.mailingAddress.city}}" data-required>
      <label class="mdl-textfield__label" for="address_city">City</label>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--6-col">
      <input class="mdl-textfield__input" type="text" id="address_state" name="addressState" value="{{user.profile.mailingAddress.state}}" data-required>
      <label class="mdl-textfield__label" for="address_state">Prefecture / state</label>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--4-col">
      <input class="mdl-textfield__input" type="text" id="address_zip" pattern="[-0-9]{1,8}" name="addressZip" value="{{user.profile.mailingAddress.zip}}" data-required>
      <label class="mdl-textfield__label" for="address_zip">Postal code</label>
      <span class="mdl-textfield__error">Please input valid postal code</span>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--4-col">
      <input class="mdl-textfield__input" type="text" id="address_country" name="addressCountry" value="{{user.profile.mailingAddress.country}}" data-required>
      <label class="mdl-textfield__label" for="address_country">Country</label>
    </div>
    <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect mdl-cell mdl-cell--4-col" for="mailing-address-private">
      <input type="checkbox" id="mailing-address-private" class="mdl-switch__input" {% if user.profile.mailingAddress.isPrivate %}checked{% endif %} name="mailingAddressPrivate" value="1">
      <span class="mdl-switch__label" id="mailing-address-private-label">Private<span class="small-screen"> (Make mailing address visible only to admins)</span></span>
      <div class="mdl-tooltip" data-mdl-for="mailing-address-private-label">
        Make mailing address visible only to admins
      </div>
    </label>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--3-col">
      <input class="mdl-textfield__input" type="text" value="{{user.profile.mobilePhone.countryCode}}" id="mobile-phone-country-code" name="mobilePhoneCountryCode" pattern="[0-9]{1,3}" data-required>
      <label class="mdl-textfield__label" for="mobile-phone-country-code">Country code</label>
      <span class="mdl-textfield__error">Example: 81</span>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--5-col">
      <input class="mdl-textfield__input" type="text" value="{{user.profile.mobilePhone.number}}" id="mobile-phone" name="mobilePhone" pattern="[0-9]{1,15}" data-required>
      <label class="mdl-textfield__label" for="mobile-phone">Mobile phone</label>
      <span class="mdl-textfield__error">Example: 8012345678</span>
    </div>
    <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect mdl-cell mdl-cell--4-col" for="mobile-phone-private">
      <input type="checkbox" id="mobile-phone-private" class="mdl-switch__input" {% if user.profile.mobilePhone.isPrivate %}checked{% endif %} name="mobilePhonePrivate" value="1">
      <span class="mdl-switch__label" id="mobile-phone-private-label">Private<span class="small-screen"> (Make mobile phone visible only to admins)</span></span>
      <div class="mdl-tooltip" data-mdl-for="mobile-phone-private-label">
        Make mobile phone visible only to admins
      </div>
    </label>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--12-col">
      <input class="mdl-textfield__input" type="text" value="{{user.profile.currentLocation}}" id="current-location" name="currentLocation">
      <label class="mdl-textfield__label" for="current-location">Current city or location (optional)</label>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--12-col">
      <textarea class="mdl-textfield__input" type="text" id="bio" name="bio" rows="3">{{user.profile.bio}}</textarea>
      <label class="mdl-textfield__label" for="bio">Short bio (optional)</label>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label mdl-cell mdl-cell--12-col">
      <textarea class="mdl-textfield__input" type="text" id="interests" name="interests" rows="3">{{user.profile.interests}}</textarea>
      <label class="mdl-textfield__label" for="interests">Areas of interest (optional)</label>
    </div>
    <button type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored mdl-cell mdl-cell--6-col">
      Save{% if !user.profile.isConfirmed %} and continue{% endif %}
    </button>
  </div>
</form>

<script>
jQuery(function($) {
  $('#upload-button').change(function() {
    $('#upload-file').val(this.files[0].name);
  });
  $('form').submit(function() {
    $(this).find("button[type='submit']").prop('disabled',true);
  });
});
</script>
{% endblock %}
